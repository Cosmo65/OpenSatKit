###############################################################################
# SimSat Ops Screen
#
# Notes:
#   1. A balance was was made to include enough telemetry to follow the example
#      ops procedure, but not too much data that it makes its difficult to
#      digest.
#
# License:
#   Written by David McComas, licensed under the copyleft GNU
#   General Public License (GPL).
#
###############################################################################

SCREEN AUTO AUTO 0.5
GLOBAL_SETTING BUTTON BACKCOLOR 221 221 221

TITLE "SimSat Operations"
  SETTING BACKCOLOR 162 181 205
  SETTING TEXTCOLOR black


VERTICALBOX "Instrument Sim (ISIM)"

  MATRIXBYCOLUMNS 4
    LABEL "Intr State"
    VALUE ISIM HK_TLM_PKT INSTR_STATE WITH_UNITS 12
    LABEL "Science State"
    VALUE ISIM HK_TLM_PKT SCI_STATE WITH_UNITS 12

    LABEL "Fault"
    VALUE ISIM HK_TLM_PKT FAULT WITH_UNITS 12
    LABEL "Sci Cycles"
    VALUE ISIM HK_TLM_PKT SCI_FILE_CYCLE_CNT WITH_UNITS 12
  END # Matrix
  
  HORIZONTAL
  LABEL "Currrent science file: "
  VALUE ISIM HK_TLM_PKT SCI_FILENAME WITH_UNITS 20
  END
  
END # Vertical ISIM

  
VERTICALBOX "Data/File Management"
  MATRIXBYCOLUMNS 4
    LABEL "HK Combo Pkts Sent"
    VALUE HK HK_TLM_PKT COMBINE_PKT_SENT_CNT WITH_UNITS 12
    LABEL "HK Missing Data Cnt"
    VALUE HK HK_TLM_PKT MISSING_DATA_CNT WITH_UNITS 12

    LABEL "DS State"
    VALUE DS HK_TLM_PKT APP_ENA_STATE WITH_UNITS 12
    LABEL "   "
    LABEL "   "

    LABEL "EVS File Enable"
    VALUE DS FILE_INFO_PKT FILE1_ENABLE WITH_UNITS 12
    LABEL "EVS File Age"
    VALUE DS FILE_INFO_PKT FILE1_AGE WITH_UNITS 12

    LABEL "Aux File Enable"
    VALUE DS FILE_INFO_PKT FILE7_ENABLE WITH_UNITS 12
    LABEL "Aux File Age"
    VALUE DS FILE_INFO_PKT FILE7_AGE WITH_UNITS 12
  END # Matrix

  HORIZONTAL
    LABEL "Current event file name: "
    VALUE DS FILE_INFO_PKT FILE1_NAME WITH_UNITS 25
  END

  HORIZONTAL
    LABEL "Current auxiliary file name: "
    VALUE DS FILE_INFO_PKT FILE7_NAME WITH_UNITS 25
  END

  MATRIXBYCOLUMNS 4
    LABEL "TFTP Files Sent"
    VALUE TFTP HK_TLM_PKT PUT_FILE_COUNT WITH_UNITS 12
    LABEL "TFTP Files Recv"
    VALUE TFTP HK_TLM_PKT GET_FILE_COUNT WITH_UNITS 12
  END
  
END # Vertical Data/File Management

VERTICALBOX "Attitude Determination and Control"

  MATRIXBYCOLUMNS 4
    LABEL '42 Connected' 
    VALUE I42 HK_TLM_PKT CONNECTED FORMATTED 10
    LABEL '42 Cycles'
    VALUE I42 HK_TLM_PKT CONNECT_CYCLES FORMATTED 10
    LABEL 'Sun Valid' 
    VALUE F42 CONTROL_PKT SUN_VALID FORMATTED 10
    LABEL 'OVR Sun Valid' 
    VALUE F42 HK_TLM_PKT OVR_SUN_VALID FORMATTED 10
  END

  MATRIXBYCOLUMNS 4 5
    LABEL '    Att Err X'
    LABEL '    Att Err Y'
    LABEL '    Att Err Z'
    LABEL '             '
    VALUE F42 CONTROL_PKT ATT_ERR_X
    VALUE F42 CONTROL_PKT ATT_ERR_Y
    VALUE F42 CONTROL_PKT ATT_ERR_Z
    BUTTON 'Plot' 'require "#{Cosmos::USERPATH}/config/targets/CFS_KIT/lib/sim_42_screen.rb"; sim_42_send_cmd(self, "PLOT_ATT_ERR")'
  END # Matrix
  
END # Attitude Determination and Control

VERTICALBOX "Autonomy"

  MATRIXBYCOLUMNS 4
    LABEL "RTS Start Cnt"
    FORMATVALUE SC HK_TLM_PKT NUM_RTS_ACTIVE %04u FORMATTED 6
    LABEL "RTS Dis 16..1"
    FORMATVALUE SC HK_TLM_PKT RTS_W1_DIS_STATUS %04X FORMATTED 6

    LABEL "RTS Start Err Cnt"
    FORMATVALUE SC HK_TLM_PKT RTS_ACTIVE_ERR_CTR %04u FORMATTED 6
    LABEL "RTS Exe 16..1"
    FORMATVALUE SC HK_TLM_PKT RTS_W1_EXE_STATUS %04X FORMATTED 6

    LABEL "LC App State"
    VALUE LC HK_TLM_PKT APP_STATE
    LABEL "RTS EXE Cnt"
    VALUE LC HK_TLM_PKT RTS_EXE_CNT

  END
  
    HORIZONTAL
       LABEL "  Watch Points (2-bits per WP)"
       ARRAY LC HK_TLM_PKT WP_RESULTS 300 50 "%x" 8 FORMATTED
    END
    HORIZONTAL
       LABEL "  Action Point (4-bits per AP)"
       ARRAY LC HK_TLM_PKT AP_RESULTS 300 50 "%x" 8 FORMATTED
    END

END # Autonomy


HORIZONTALLINE
LABEL "Flight Event Messages"
NAMED_WIDGET evs_msg_t TEXTBOX CFE_EVS EVENT_MSG_PKT MESSAGE 512 50